---
title: "Dimensions of the impacts of land transitions in the Amazon and Cerrado"
author: 
  - name: Hugo Tameirão Seixas
    email: seixas.hugo@protonmail.com
    url: hugotseixas.com
    affiliations:
      - name: State University of Campinas
format: 
  html:
    theme: lux
page-layout: article
bibliography: references.bib
link-citations: true
editor: visual
editor_options: 
  chunk_output_type: console
execute:
  freeze: auto
  cache: true
license: CC BY-NC-ND 4.0
---

```{r}
#| include: false

library(sf)
library(geobr)
library(gt)
library(DiagrammeR)
library(lubridate)
library(tidyverse)

```

## Introduction

## Objectives

The present work is composed of  three main objectives, accompanied by related questions:

1.  Predict probability and area of native vegetation suppression in the Amazon and Cerrado;
    a.  What are the main drivers of native vegetation suppression?
    b.  How do drivers interact among them?
2.  Predict land cover transition trajectories after native vegetation suppression;
    a.  What are the main drivers of land cover dynamics after native vegetation suppression?
    b.  How do drivers interact among them?
    c.  What are the main patterns for future projections in the Amazon and Cerrado?
3.  Predict the impact of land cover transitions over environmental and social variables;
    a.  What is the importance of land cover transitions in predicting environmental and social variables?
    b.  Does land-use transitions interact with other drivers of environmental and social variables?
    c.  What are the expected social and environmental projections in different land-cover trajectories for the near future?

## Materials and Methods

To achieve the proposed goal, I will divide the work into three major parts:

1.  Literature overview of the main drivers of the expected outcomes (vegetation suppression, land cover transition, social and environmental variables);

2.  Screening for available data and development of structured data collection;

3.  Development of models;

4.  Future projections;

```{r}
#| echo: false

grViz(
  "digraph {
  
  graph [layout = dot, 
         rankdir = TD, 
         nodesep = 1.5, 
         ranksep = 1.0,
         tooltip = ' ']
  
  node [shape = box,
        fontname = Helvetica,
        style = filled,
        fontcolor = '#343a40'
        fillcolor = '#f7f7f9'
        penwidth = 2.5,
        width = 3,
        height = 1.2,
        fontsize = 25,
        tooltip = ' ']

  edge [penwidth = 2.5, 
        arrowsize = 2,
        tooltip = ' ']

  a [label = 'Literature \n Review', xlabel = '1']
  b [label = 'Experts Survey', xlabel = '1']
  c [label = 'Available Data', xlabel = '2']
  d [label = 'Database \n Structuring', xlabel = '2']
  e [label = 'Models \n Development', xlabel = '3']
  f [label = 'Projections \n Scenarios', xlabel = '4']
  g [label = 'Projections \n Estimations', xlabel = '4']
  
  a -> c a -> d
  c -> d b -> d
  b -> e b -> f
  e -> g f -> g
  d -> e
  
  }"
)

```

#### Literature Overview

The literature overview will be performed over different subjects.

#### Database Structuring

The database will contain data from different themes. To structure a collection of data which presents different nature, I will transform them into a common grid system. The grid system will be composed by 0.3 degrees cells.

```{r}
#| echo: false
#| message: false

biomes <- read_biomes(showProgress = FALSE) %>%
  filter(name_biome %in% c("Amazônia", "Cerrado")) %>%
  st_make_valid()

grid <- 
  st_make_grid(biomes, cellsize = 0.3) %>%
  st_as_sf() %>%
  st_filter(biomes, .predicate = st_intersects)

ggplot() +
  geom_sf(data = biomes) +
  geom_sf(data = grid, fill = "transparent") +
  theme_void()

```


#### Model Development

The models will follow a sequential order. The output of a model will serve as a feature to the next model. 

```{r}
#| echo: false

table <-
  tibble(
    section = c(
      "Vegetation suppression probability", "Vegetation suppression area", 
      "Land cover transitions", "Transitions impacts"
    ),
    model_type = c(
      "Classification", "Regression",
      "Classification", "Regression"
    )
  )

table %>%
  pivot_wider(names_from = section, values_from = model_type) %>%
  gt() %>%
  cols_align(align = "center") %>%
  tab_options(
    table.border.top.style = "hidden",
    table.border.bottom.style = "hidden"
  )

```

The first model will classify areas that suffered vegetation suppression. So the outcome will be a binary result (0 = no suppression; 1 = suppression). I want that this model to have the minimum inclusion errors for the class "1". In other words, I want to avoid, as best as I can, classifying an area with label "1", when the reality is that the area should be label "0". To achieve this, the model will be adjusted to present the minimum inclusion error for the class "1", and the probability threshold for class "1" will be a higher value.

The second model will predict the amount of vegetation suppression that was classified with the label "1" in the previous model. The predictions will have to be bounded by the amount of natural vegetation inside the grid cell.

The third model will predict the predominant land use transitions of the areas that suffered native vegetation suppression.

The fourth model will be actually a set of models. Each model will be responsible to predict environmental and social outcomes from land transition patterns.

## Results

## Discussion

## Conclusions

## Schedule

```{r}
#| echo: false
#| warning: false

schedule_table <- 
  bind_rows(
    list(
      activity = "Literature Review",
      start = "01-02-2023",
      end = "01-06-2023",
      section = 1
    ),
    list(
      activity = "Experts Survey",
      start = "01-06-2023",
      end = "01-01-2024",
      section = 1
    ),
    list(
      activity = "Data Screening",
      start = "01-02-2023",
      end = "01-08-2023",
      section = 2
    ),
    list(
      activity = "Database Structuring",
      start = "01-04-2023",
      end = "01-09-2023",
      section = 2
    ),
    list(
      activity = "Exploratory Data Analisys",
      start = "01-06-2023",
      end = "01-11-2023",
      section = 2
    ),
    list(
      activity = "Models Development",
      start = "01-11-2023",
      end = "01-05-2024",
      section = 3
    ),
    list(
      activity = "Projections Estimations",
      start = "01-05-2024",
      end = "01-09-2024",
      section = 4
    )
  )

schedule_table <- schedule_table %>%
  mutate(
    start = dmy(start),end = dmy(end),
    activity = factor(activity, levels = activity)
  ) %>%
  pivot_longer(
    cols = c(start, end),
    names_to = "when",
    values_to = "date"
  )

schedule_table %>%
    ggplot() +
    geom_line(
      aes(x = date, y = activity), 
      linewidth = 3, 
      lineend = "round"
    ) +
    scale_y_discrete(limits = rev) +
    scale_x_date(
      date_labels = "%b-%Y", 
      date_breaks = "6 months", 
      date_minor_breaks = "1 month",
      limits = c(ymd("2022-09-01"), ymd("2025-03-01"))
    ) +
    labs(color = "Section") +
    theme_minimal() + 
    theme(
      text = element_text(family = "sans", size = 15),
      panel.grid.major = element_line(color = "#a9a9a9"),
      axis.title = element_blank(),
      axis.text.x = element_text(angle = 35, vjust = 0.6),
      plot.margin = margin(0.5, 0.5, 0.5, 0.5, "cm"),
      legend.position = "bottom"
    )

```

## References
