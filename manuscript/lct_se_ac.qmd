---
title: "Dimensions of the impacts of land transitions in the Amazon and Cerrado"
author: 
  - name: Hugo Tameirão Seixas
    email: seixas.hugo@protonmail.com
    url: hugotseixas.com
    affiliations:
      - name: State University of Campinas
format: 
  html:
    theme: lux
page-layout: article
bibliography: references.bib
link-citations: true
editor_options: 
  chunk_output_type: console
execute:
  freeze: auto
  cache: true
license: CC BY-NC-ND 4.0
self-contained: true
---

```{r}
#| label: libraries
#| include: false

library(sf)
library(geobr)
library(gt)
library(DiagrammeR)
library(lubridate)
library(tidyverse)

```

## Introduction

The suppression of native vegetation in the Cerrado and Amazon biomes is a matter of great concern due to its potential impact on the environment and human well-being. 
Understanding the drivers and effects of this phenomenon is crucial to guide policies to avoid natural vegetation suppression and mitigate negative impacts.
However, this is a challenging task since the factors involved in this phenomenon are diverse, heterogeneous, and can even be contradictory. 
Existing literature suggests that native vegetation suppression is caused by economic fluctuations [@hargrave-2012], conservation policies [@pfaff-2015], population distribution [@jusys-2016], land tenure [@cattaneo-2001], livestock and crop productions [@bowman-2016].
On the other side, vegetation removal may impact human health [@santos-2018], climate regime [@silva-2023], regional hydrology [@cavalcante-2019], soil properties [@dias-2022], biodiversity [@gestich-2021].

Unfortunately, much of the research in this area tends to focus on only a few dimensions of the problem, rather than taking a holistic approach.
This narrow focus often fails to capture the full extent of the issue and can lead to oversimplifications or misdirection in efforts to solve it.

The objective of this project is to create a modelling framework, designed to  predict and understand the causes and impacts of native vegetation suppression in the Cerrado and Amazon biomes, considering environmental and anthropic dimensions. 
The project aims to develop a deeper understanding of the relationships between land use changes, environmental factors, and social dynamics related to the suppression of native vegetation.

To achieve the objective, regression and classification models will be applied to existing data on land use changes, environmental factors, and social variables in the Cerrado and Amazon biomes. 
The models will be used to identify patterns and relationships between these variables, and to predict future trends.

The results of this project will contribute to a better understanding of the causes and impacts of native vegetation suppression in the Cerrado and Amazon biomes. 
This knowledge will inform the development of effective conservation and management strategies that will help to protect these vital and unique ecosystems.

## Objectives

The present work is composed of three main objectives, accompanied by related questions:

1.  Predict probability and area of native vegetation suppression in the Amazon and Cerrado;
    a.  What are the main drivers of native vegetation suppression?
    b.  How do drivers interact among them?
2.  Predict land cover transition trajectories after native vegetation suppression;
    a.  What are the main drivers of land cover dynamics after native vegetation suppression?
    b.  How do drivers interact among them?
    c.  What are the main patterns for future projections in the Amazon and Cerrado?
3.  Predict the impact of land cover transitions over environmental and social variables;
    a.  What is the importance of land cover transitions in predicting environmental and social variables?
    b.  Does land-use transitions interact with other drivers of environmental and social variables?
    c.  What are the expected social and environmental projections in different land-cover trajectories for the near future?
    d.  Do predictions from both biomes show relation between each other? 

The three objectives, in conjunction, will provide an in-depth analysis of what can be done to avoid native vegetation suppression, and how to mitigate its negative impacts.

## Materials and Methods

The study will rely on the use of available data to develop regression and classification models that will predict native vegetation suppression and its impacts. 
To achieve the proposed goal, I will divide the work into four major parts:

1.  Literature overview of the main drivers of the expected outcomes (vegetation suppression, land cover transition, social and environmental variables);

2.  Screening for available data and development of structured data collection;

3.  Development of models;

4.  Future projections;

```{r}
#| label: method-diagram
#| echo: false

grViz(
  "digraph {
  
  graph [layout = dot, 
         rankdir = TD, 
         nodesep = 1.2, 
         ranksep = 0.8,
         tooltip = ' ']
  
  node [shape = box,
        fontname = Helvetica,
        style = filled,
        fontcolor = '#343a40'
        fillcolor = '#f7f7f9'
        penwidth = 2.5,
        width = 3,
        height = 1.2,
        fontsize = 25,
        tooltip = ' ']

  edge [penwidth = 2.5, 
        arrowsize = 2,
        tooltip = ' ']

  a [label = 'Literature \n Review', xlabel = '1']
  b [label = 'Experts Survey', xlabel = '1']
  c [label = 'Available Data', xlabel = '2']
  d [label = 'Database \n Structuring', xlabel = '2']
  e [label = 'Models \n Development', xlabel = '3']
  f [label = 'Projections \n Scenarios', xlabel = '4']
  g [label = 'Projections \n Estimations', xlabel = '4']
  
  a -> c a -> d
  c -> d b -> d
  b -> e b -> f
  e -> g f -> g
  d -> e
  
  }"
)

```

\

The literature review will provide a theoretical and practical basis for the modelling section. 
Information about what variables are being used, how are they being manipulated, and what are the analysis techniques used to reach the results.

The database structuring will store all the relevant data in a single file structure, so that the modelling section can be performed in a clean and organized manner.

The models will be developed following standard procedures and libraries that allow the implementation of different techniques. 
The choice of models will be done after a series of tests, and will depend on the accuracy and the adequacy to the theory. Each model will be stored as a mean to be reproduced when needed.

Future projections will serve as a bridge to discuss how public policies can be planned to mitigate negative impacts of native vegetation suppression in the Amazon and Cerrado.

#### Literature Review

The literature review will be performed over different subjects. 
For all of them, an hybrid approach will be adopted, in which database searches are combined with snowball searches.

```{r}
#| label: lit-review-diagram
#| echo: false

grViz(
  "digraph {
  
  graph [layout = dot, 
         overlap = false,
         rankdir = TB, 
         nodesep = 5, 
         ranksep = 0.4,
         tooltip = ' ']
  
  node [shape = box,
        fontname = Helvetica,
        style = filled,
        fontcolor = '#343a40'
        fillcolor = '#f7f7f9'
        penwidth = 2.5,
        width = 3,
        height = 1.2,
        fontsize = 25,
        tooltip = ' ']

  edge [penwidth = 2.5, 
        arrowsize = 2,
        tooltip = ' ']

  a [label = 'Specific \n Questions']
  b [label = 'Query \n Development']
  c [label = 'Database Search']
  d [label = 'Documents \n Screening']
  e [label = 'Documents \n Collection']
  f [label = 'Forward Snowball \n Search']
  g [label = 'Final Collection']
  
  a -> b a -> d
  b -> c c -> d
  d -> e e -> f
  f -> d e -> g
  
  }"
)

```

\

The literature review will serve to answer questions about variables that will be predicted in this project. 
For each variable, I want to explore what are the main drivers that are causing them, how these drivers relate with each other, and what were the methods used to estimate the effects and interactions. 

#### Database Structuring

The database will contain data from different domains, which can be available in different formats and structures.
It is vital that all variables of interests are organized in a coherent manner, so that the modelling process can be more efficient and transparent.
To structure a collection of data which presents different nature, I will transform all the variables to fit into a common grid system.
The grid system will be composed by 0.2 degrees cells (40km x 40km), which should be a balanced compromise between detail and computational cost. 

```{r}
#| label: grid-map-figure
#| echo: false
#| message: false

biomes <- read_biomes(showProgress = FALSE) %>%
  filter(name_biome %in% c("Amazônia", "Cerrado")) %>%
  st_make_valid()

grid <- 
  st_make_grid(biomes, cellsize = 0.2) %>%
  st_as_sf() %>%
  st_filter(biomes, .predicate = st_intersects)

ggplot() +
  geom_sf(data = biomes) +
  geom_sf(data = grid, fill = "transparent") +
  theme_void()

```

Each grid cell will contain an observation, for each year, for all the variables that will be included in the study. 
Only pixels that contained natural vegetation at the first year of the analysis will be considered valid.

The process to create the database will consist of accessing the data sources, download the data to the local environment, transform and organize the data to the common grid (if the data source provides any kind of pre-processing tool before download the data, it should be done that way), and store in the local environment.

```{r}
#| label: database-diagram
#| echo: false
#| message: false

grViz(
  "digraph {
  
  graph [layout = dot, 
         overlap = false,
         rankdir = TB, 
         nodesep = 1.4, 
         ranksep = 0.8,
         tooltip = ' ']
  
  node [shape = box,
        fontname = Helvetica,
        style = filled,
        fontcolor = '#343a40'
        fillcolor = '#f7f7f9'
        penwidth = 2.5,
        width = 3,
        height = 1.2,
        fontsize = 25,
        tooltip = ' ']

  edge [penwidth = 2.5, 
        arrowsize = 2,
        tooltip = ' ']

  a [label = 'Data Source']
  b [label = 'Data Source']
  c [label = 'Data Source']
  d [label = 'Data Source']
  e [label = 'Pre Processing']
  f [label = 'Gridded Data']
  g [label = 'Database']
  
  a -> e b -> e
  c -> e d -> e
  e -> f f -> g
  
  }"
)

```

The data will be stored in a nested directories structured database, using give-style partitioning. 
The database will be composed by a collection of parquet files, a format with high compression, that facilitates processing large volumes of data.
The basic partition will be the variables, which means that each variable will be stored in a separated directory.
If necessary, the data will be partitioned by further variables (as a rule of thumb, each parquet file should not be smaller than 20MB and not bigger than 2GB).

#### Model Development

The models will follow a sequential order.
The output of a model will serve as a feature to the next model.

```{r}
#| label: model-table
#| echo: false

table <-
  tibble(
    section = c(
      "Vegetation suppression probability", "Vegetation suppression area", 
      "Land cover transitions", "Transitions impacts"
    ),
    model_type = c(
      "Classification", "Regression",
      "Classification", "Regression"
    )
  )

table %>%
  pivot_wider(names_from = section, values_from = model_type) %>%
  gt() %>%
  cols_align(align = "center") %>%
  tab_options(
    table.border.top.style = "hidden",
    table.border.bottom.style = "hidden"
  )

```

The first model will classify areas that suffered vegetation suppression.
So the outcome will be a binary result (0 = no suppression; 1 = suppression).
I want that this model to have the minimum inclusion errors for the class "1".
In other words, I want to avoid, as best as I can, classifying an area with label "1", when the reality is that the area should be label "0".
To achieve this, the model will be adjusted to present the minimum inclusion error for the class "1", and the probability threshold to classify an observation as class "1" will be a higher value.

The second model will predict the amount of vegetation suppression that was classified with the label "1" in the previous model.
The predictions will have to be bounded by the amount of natural vegetation inside the grid cell (a poisson distribution may be adequate to represent this variable).

The third model will predict the predominant land use transitions of the areas that suffered native vegetation suppression.

The fourth model will be actually a set of models.
Each model will be responsible to predict a single environmental or social outcome.

Each model will follow the standard approach to develop supervised models.

```{r}
#| label: model-diagram
#| echo: false
#| message: false

grViz(
  height = 800,
  "digraph {
  
  graph [layout = dot, 
         overlap = false,
         rankdir = TD, 
         nodesep = 1.8, 
         ranksep = 0.5,
         tooltip = ' ']
  
  node [shape = box,
        fontname = Helvetica,
        style = filled,
        fontcolor = '#343a40'
        fillcolor = '#f7f7f9'
        penwidth = 2.5,
        width = 3,
        height = 1.2,
        fontsize = 25,
        tooltip = ' ']

  edge [penwidth = 2.5, 
        arrowsize = 2,
        tooltip = ' ']

  a [label = 'Database']
  b [label = 'Variables \n Selection']
  c [label = 'Data Split']
  d [label = 'Training Data']
  e [label = 'Validation \n Data']
  f [label = 'Test Data']
  g [label = 'Pre Processing']
  h [label = 'Initial \n Model Fit']
  i [label = 'Parameters \n Adjustments']
  j [label = 'Final \n Model Fit']
  k [label = 'Model \n Assessment']
  l [label = 'Model \n Interpretation']
  
  a -> b b -> c
  c -> d c -> e c -> f 
  d -> g g -> h 
  h -> i e -> i
  i -> j j -> k f -> k
  j -> l k -> l
  
  }"
)

```

\

To understand and interpret the predictions made by the models, I will employ a variety of methods to interpret prediction models. They may include surrogate models, feature interactions, permutation feature importance, counterfactual explanations, and Shapley values. 
These methods are model-agnostic, meaning they can be applied to any type of regression or classification model, regardless of its underlying structure or parameters.
By using these techniques, I aim to gain a deeper understanding of the relationships between the variables and how they contribute to the predictions.
This information will help to assess the reliability of the models and the validity of their results.

## Results

The study will present three main quantitative results based on quantitative data: predictions on vegetation suppression, land use transitions, and social and environmental variables. 
Our predictions on vegetation suppression will show the likelihood and extent of removal events, serving as a basis for predicting the land use changes of the affected grid cells. 
Finally, we will predict the impact of these findings on the environment and human well-being.

As part of the study, I will not only present the predictions generated by the models, but also perform an in-depth analysis of the models behavior. 
This analysis will provide a deeper understanding of the underlying mechanisms that drive the predictions and help to assess their reliability and accuracy.
Furthermore, based on my confidence in the models and their results, I will make inferences about the studied phenomena. 
This will allow me to go beyond the mere presentation of the predictions and offer insights into the relationships between the variables, the causes of the observed patterns, and the implications of the results for the environment and human well-being. 
However, it is important to note that I will only take this step if I feel confident in the models and their results, as making inferences requires a strong foundation of knowledge and understanding.

## Discussion

In this study, I will be comparing the outcomes of my models, which are grounded in regression and classification predictive modeling, to the conclusions drawn from previous research that primarily utilized statistical inference and mechanistic models.
My aim is to analyze the potential advantages and limitations of the methodology I have developed through this comparison.

In addition to comparing the results of my models with previous research, I will also be exploring the practical implications of the findings.
Specifically, I will be examining how the results can be used to inform and support decision making, particularly when dealing with complex environmental and human well-being issues that involve multiple dimensions. 
In many cases, decision making related to vegetation removals and their impact on the environment and human well-being can be challenging due to the multiple and sometimes conflicting factors that need to be considered.

The findings can be used to identify the most significant factors that contribute to vegetation removals and their impact on the environment and human well-being, as well as how these factors interact with one another. 
This information can then be used to prioritize the most pressing issues and to design targeted interventions and strategies to mitigate the negative effects of vegetation removals.

## Conclusions

The main objective of the project is to delve deeper into the reasons behind vegetation removals and to assess their impact on the environment and human well-being. 
This effort has the potential to provide valuable insights into what can be done to reduce the negative consequences after the vegetation removal. 
By thoroughly investigating the causes of vegetation removal and its effects, the project aims to contribute to a better understanding of this complex issue and to identify strategies for mitigating its negative impact. 
The end goal is to ensure that future vegetation removal is carried out in a way that minimizes harm to the environment and supports the well-being of people who depend on it.

## Schedule

```{r}
#| echo: false
#| warning: false

schedule_table <- 
  bind_rows(
    list(
      activity = "Literature Review",
      start = "01-02-2023",
      end = "01-07-2023",
      section = 1
    ),
    list(
      activity = "Experts Survey",
      start = "01-06-2023",
      end = "01-01-2024",
      section = 1
    ),
    list(
      activity = "Data Screening",
      start = "01-02-2023",
      end = "01-08-2023",
      section = 2
    ),
    list(
      activity = "Database Structuring",
      start = "01-04-2023",
      end = "01-09-2023",
      section = 2
    ),
    list(
      activity = "Exploratory Data Analisys",
      start = "01-06-2023",
      end = "01-11-2023",
      section = 2
    ),
    list(
      activity = "Models Development",
      start = "01-11-2023",
      end = "01-05-2024",
      section = 3
    ),
    list(
      activity = "Projections Estimations",
      start = "01-05-2024",
      end = "01-09-2024",
      section = 4
    )
  )

schedule_table <- schedule_table %>%
  mutate(
    start = dmy(start),end = dmy(end),
    activity = factor(activity, levels = activity)
  ) %>%
  pivot_longer(
    cols = c(start, end),
    names_to = "when",
    values_to = "date"
  )

schedule_table %>%
    ggplot() +
    geom_line(
      aes(x = date, y = activity), 
      linewidth = 3, 
      lineend = "round"
    ) +
    scale_y_discrete(limits = rev) +
    scale_x_date(
      date_labels = "%b-%Y", 
      date_breaks = "6 months", 
      date_minor_breaks = "1 month",
      limits = c(ymd("2022-09-01"), ymd("2025-03-01"))
    ) +
    labs(color = "Section") +
    theme_minimal() + 
    theme(
      text = element_text(family = "sans", size = 15),
      panel.grid.major = element_line(color = "#a9a9a9"),
      axis.title = element_blank(),
      axis.text.x = element_text(angle = 35, vjust = 0.6),
      plot.margin = margin(0.5, 0.5, 0.5, 0.5, "cm"),
      legend.position = "bottom"
    )

```

## References
